<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Anime Fanz Fz - Anime Provider</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@600;700&family=Exo+2:wght@300;400;700;900&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
    :root{
        --orange:#ff6a00; --pink:#ff007a;
        --cyan:#00ffe0;   --purple:#9b00ff;
        --gold:#ffd700;
        --bg:#020510;     --glass:rgba(255,255,255,0.04);
    }
    *{ margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
    body{ background:var(--bg); font-family:'Exo 2',sans-serif; color:white; min-height:100vh; display:flex; flex-direction:column; align-items:center; overflow-x:hidden; }
    .bg-scene{ position:fixed; inset:0; z-index:-1; overflow:hidden; }
    .bg-scene::before{ content:''; position:absolute; inset:-50%; background:radial-gradient(ellipse 60% 40% at 20% 30%,rgba(255,106,0,.12) 0%,transparent 60%),radial-gradient(ellipse 50% 50% at 80% 70%,rgba(155,0,255,.12) 0%,transparent 60%),radial-gradient(ellipse 70% 40% at 50% 90%,rgba(0,255,224,.08) 0%,transparent 60%); animation:aurora 18s ease-in-out infinite alternate; }
    @keyframes aurora{ 0%{transform:translate(0,0) scale(1)} 50%{transform:translate(-3%,4%) scale(1.04)} 100%{transform:translate(3%,-3%) scale(.97)} }
    .bg-scene::after{ content:''; position:absolute; inset:0; background-image:linear-gradient(rgba(0,255,224,.03) 1px,transparent 1px),linear-gradient(90deg,rgba(0,255,224,.03) 1px,transparent 1px); background-size:40px 40px; animation:grid-pulse 6s ease-in-out infinite; }
    @keyframes grid-pulse{ 0%,100%{opacity:.5} 50%{opacity:1} }
    .orb{ position:fixed; border-radius:50%; filter:blur(80px); z-index:-1; pointer-events:none; animation:orb-float linear infinite; }
    .orb-1{ width:280px;height:280px;background:rgba(255,0,122,.15);top:-10%;left:-10%;animation-duration:22s; }
    .orb-2{ width:220px;height:220px;background:rgba(0,255,224,.12);bottom:-5%;right:-5%;animation-duration:18s;animation-delay:-9s; }
    .orb-3{ width:180px;height:180px;background:rgba(155,0,255,.15);top:40%;left:-8%;animation-duration:25s;animation-delay:-5s; }
    @keyframes orb-float{ 0%,100%{transform:translateY(0) scale(1)} 50%{transform:translateY(-40px) scale(1.08)} }
    .scan-line{ position:fixed;top:-2px;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--cyan),transparent);animation:scan 6s linear infinite;z-index:100;opacity:.4;pointer-events:none; }
    @keyframes scan{ 0%{top:-2px} 100%{top:100vh} }
    .header{ width:100%;height:200px;position:relative;display:flex;flex-direction:column;justify-content:center;align-items:center;overflow:hidden;margin-bottom:24px; }
    .header::before{ content:'';position:absolute;inset:0;background:linear-gradient(160deg,#1a0028 0%,#050018 50%,#001a1a 100%); }
    .header::after{ content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--orange),var(--pink),var(--purple),var(--cyan),var(--orange));background-size:200% 100%;animation:stripe 3s linear infinite; }
    @keyframes stripe{ to{background-position:200% 0} }
    .header-slash{ position:absolute;top:0;right:0;bottom:0;width:50%;background:linear-gradient(135deg,transparent 40%,rgba(255,0,122,.06) 100%);clip-path:polygon(60% 0,100% 0,100% 100%,20% 100%); }
    .header-bottom-clip{ position:absolute;bottom:-1px;left:0;right:0;height:40px;background:var(--bg);clip-path:polygon(0 100%,50% 0%,100% 100%); }
    .logo-wrap{ position:relative;z-index:2;text-align:center; }
    .logo-tag{ font-size:10px;letter-spacing:6px;color:var(--cyan);font-weight:300;text-transform:uppercase;margin-bottom:8px;opacity:.7;animation:fiu .8s ease both; }
    .main-title{ font-family:'Rajdhani',sans-serif;font-size:clamp(22px,7vw,30px);font-weight:700;letter-spacing:8px;text-transform:uppercase;position:relative;animation:fiu .8s ease both .2s;line-height:1; }
    .main-title::before,.main-title::after{ content:attr(data-text);position:absolute;top:0;left:0;width:100%; }
    .main-title::before{ color:var(--pink);clip-path:polygon(0 0,100% 0,100% 40%,0 40%);animation:gt 5s infinite linear; }
    .main-title::after{  color:var(--cyan);clip-path:polygon(0 60%,100% 60%,100% 100%,0 100%);animation:gb 5s infinite linear; }
    @keyframes gt{ 0%,90%,100%{transform:translate(0);opacity:0} 92%{transform:translate(-3px,-1px);opacity:.8} 94%{transform:translate(3px,1px);opacity:.8} }
    @keyframes gb{ 0%,90%,100%{transform:translate(0);opacity:0} 93%{transform:translate(3px,1px);opacity:.6} 95%{transform:translate(-3px,-1px);opacity:.6} }
    .logo-sub{ font-size:9px;letter-spacing:4px;color:rgba(255,255,255,.3);margin-top:10px;text-transform:uppercase;animation:fiu .8s ease both .4s; }
    @keyframes fiu{ from{opacity:0;transform:translateY(15px)} to{opacity:1;transform:translateY(0)} }
    .key-wrap{ position:absolute;top:16px;right:16px;z-index:10;width:36px;height:36px;border-radius:50%;background:rgba(0,255,224,.08);border:1px solid rgba(0,255,224,.2);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s;animation:key-pulse 3s ease-in-out infinite; }
    .key-wrap:active{ transform:scale(.9); }
    @keyframes key-pulse{ 0%,100%{box-shadow:0 0 8px rgba(0,255,224,.2)} 50%{box-shadow:0 0 18px rgba(0,255,224,.5)} }
    .key-wrap i{ font-size:14px;color:var(--cyan); }
    .key-wrap.active{ border-color:rgba(0,255,136,.4);animation:key-active 2s ease-in-out infinite; }
    @keyframes key-active{ 0%,100%{box-shadow:0 0 8px rgba(0,255,136,.3)} 50%{box-shadow:0 0 22px rgba(0,255,136,.7)} }
    .key-wrap.active i{ color:#00ff88; }

    /* TOKEN MODAL */
    .modal-overlay{ position:fixed;inset:0;z-index:9000;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.9);backdrop-filter:blur(16px);padding:20px; }
    .modal-overlay.hidden{ display:none; }
    .token-box{ background:linear-gradient(135deg,rgba(0,255,224,.04),rgba(155,0,255,.06));border:1px solid rgba(0,255,224,.22);border-radius:24px;padding:28px 22px;width:100%;max-width:310px;text-align:center;position:relative; }
    .token-box::before{ content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--cyan),var(--purple),transparent);border-radius:24px 24px 0 0; }
    .tk-title{ font-family:'Orbitron',sans-serif;font-size:13px;letter-spacing:3px;color:var(--cyan);margin-bottom:5px; }
    .tk-sub{ font-size:10px;color:rgba(255,255,255,.3);letter-spacing:1px;margin-bottom:18px; }
    .tk-input{ width:100%;background:rgba(255,255,255,.04);border:1px solid rgba(0,255,224,.2);border-radius:12px;padding:11px 13px;color:white;font-size:12px;font-family:'Exo 2',sans-serif;letter-spacing:1px;outline:none;margin-bottom:10px; }
    .tk-input:focus{ border-color:rgba(0,255,224,.5); }
    .tk-btn{ width:100%;padding:11px;background:linear-gradient(135deg,var(--cyan),var(--purple));border:none;border-radius:12px;color:#000;font-weight:800;font-size:11px;letter-spacing:2px;text-transform:uppercase;font-family:'Exo 2',sans-serif;cursor:pointer;margin-bottom:9px;transition:transform .15s; }
    .tk-btn:active{ transform:scale(.97); }
    .tk-msg{ font-size:11px;letter-spacing:1px;min-height:16px;margin-bottom:10px; }
    .tk-msg.ok{ color:#00ff88; }
    .tk-msg.err{ color:var(--pink); }
    .tk-close{ background:transparent;border:1px solid rgba(255,255,255,.1);border-radius:8px;color:rgba(255,255,255,.3);font-size:10px;letter-spacing:2px;padding:6px 14px;cursor:pointer;font-family:'Exo 2',sans-serif; }
    .tk-status{ display:none;text-align:center; }
    .tk-status.show{ display:block; }
    .tk-badge{ display:inline-flex;align-items:center;gap:7px;background:rgba(0,255,136,.07);border:1px solid rgba(0,255,136,.25);border-radius:20px;padding:6px 16px;margin-bottom:14px; }
    .tk-dot{ width:7px;height:7px;border-radius:50%;background:#00ff88;box-shadow:0 0 8px #00ff88;animation:blink 2s ease-in-out infinite; }
    @keyframes blink{ 0%,100%{opacity:1} 50%{opacity:.3} }
    .tk-badge-lbl{ font-size:10px;letter-spacing:2px;color:#00ff88;font-family:'Orbitron',sans-serif; }
    .tk-time{ font-family:'Orbitron',sans-serif;font-size:26px;font-weight:700;color:var(--cyan);margin-bottom:3px; }
    .tk-time-sub{ font-size:9px;color:rgba(255,255,255,.22);letter-spacing:3px;text-transform:uppercase;margin-bottom:18px; }
    .tk-input-panel{ display:block; }

    /* AD OVERLAY */
    .ad-overlay{ position:fixed;inset:0;z-index:8000;background:linear-gradient(180deg,#02020e 0%,#0a0118 50%,#020510 100%);display:flex;flex-direction:column;align-items:center;padding:0;overflow-y:auto; }
    .ad-overlay.hidden{ display:none; }
    .ad-topbar{ width:100%;max-width:420px;display:flex;align-items:center;justify-content:space-between;padding:14px 18px 0; }
    .ad-topbar-brand{ font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:3px;color:rgba(255,255,255,.2); }
    .ad-topbar-dots{ display:flex;gap:5px; }
    .ad-dot{ width:8px;height:8px;border-radius:50%;background:rgba(255,255,255,.12);transition:all .3s; }
    .ad-dot.done{ background:rgba(0,255,224,.5); }
    .ad-dot.active{ background:var(--cyan);box-shadow:0 0 10px var(--cyan); }
    .ad-note{ width:100%;max-width:420px;padding:12px 18px 0;text-align:center; }
    .ad-note-text{ font-family:'Orbitron',sans-serif;font-size:8px;letter-spacing:1.2px;color:rgba(255,255,255,.25);line-height:1.9; }
    .ad-note-text span{ color:rgba(0,255,224,.5); }
    .ad-counter-wrap{ width:100%;max-width:420px;padding:10px 18px 0;display:flex;align-items:center;gap:10px; }
    .ad-counter-num{ font-family:'Orbitron',sans-serif;font-size:11px;letter-spacing:4px;color:var(--cyan); }
    .ad-counter-bar{ flex:1;height:3px;background:rgba(255,255,255,.06);border-radius:3px;overflow:hidden; }
    .ad-counter-fill{ height:100%;background:linear-gradient(90deg,var(--cyan),var(--purple));border-radius:3px;transition:width .5s ease; }
    .ad-card{ width:calc(100% - 32px);max-width:388px;background:rgba(255,255,255,.025);border:1px solid rgba(255,255,255,.07);border-radius:22px;overflow:hidden;margin:12px auto 0;position:relative; }
    .ad-card::before{ content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,rgba(0,255,224,.3),transparent); }
    .ad-video{ width:100%;height:auto;display:block; }
    .ad-mute{ position:absolute;top:10px;right:10px;width:32px;height:32px;border-radius:50%;background:rgba(0,0,0,.6);border:1px solid rgba(255,255,255,.2);display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:5; }
    .ad-mute i{ font-size:12px;color:white; }
    .ad-link-inner{ padding:32px 24px;text-align:center; }
    .ad-tv-icon{ font-size:36px;margin-bottom:14px;filter:drop-shadow(0 0 12px rgba(0,255,224,.3)); }
    .ad-link-num{ font-family:'Orbitron',sans-serif;font-size:10px;letter-spacing:3px;color:rgba(255,255,255,.3);margin-bottom:10px; }
    .ad-link-desc{ font-size:11px;color:rgba(255,255,255,.45);line-height:2;letter-spacing:.5px; }
    .ad-link-desc b{ color:rgba(255,255,255,.8); }
    .ad-hyperlink{ color:var(--cyan);text-decoration:none;border-bottom:1px solid rgba(0,255,224,.4);padding-bottom:1px;font-weight:700; }
    .ad-timer-wrap{ display:flex;flex-direction:column;align-items:center;gap:4px;margin:14px 0 10px; }
    .ad-timer-ring{ position:relative;width:56px;height:56px; }
    .ad-timer-ring svg{ transform:rotate(-90deg); }
    .ad-timer-ring circle{ fill:none;stroke-width:3;stroke-linecap:round; }
    .ad-timer-ring .trk{ stroke:rgba(255,255,255,.07); }
    .ad-timer-ring .prg{ stroke:var(--cyan);transition:stroke-dashoffset 1s linear; }
    .ad-timer-num{ position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-family:'Orbitron',sans-serif;font-size:17px;font-weight:700;color:var(--cyan); }
    .ad-timer-lbl{ font-size:8px;letter-spacing:2px;color:rgba(255,255,255,.18);text-transform:uppercase; }
    .ad-continue{ display:none;width:calc(100% - 32px);max-width:388px;margin:0 auto 16px;padding:13px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.12);border-radius:14px;color:rgba(255,255,255,.65);font-size:11px;letter-spacing:2px;text-transform:uppercase;font-family:'Exo 2',sans-serif;cursor:pointer;transition:all .2s;animation:fiu .4s ease both; }
    .ad-continue.show{ display:block; }
    .ad-continue:active{ transform:scale(.97); }
    .ad-finish{ display:none;width:calc(100% - 32px);max-width:388px;margin:0 auto 24px;position:relative; }
    .ad-finish.show{ display:block;animation:fiu .5s ease both; }
    .confetti-side{ position:absolute;top:0;pointer-events:none; }
    .confetti-left{ left:-8px; } .confetti-right{ right:-8px; }
    .confetti-piece{ position:absolute;border-radius:2px;animation:c-fall 1.2s ease-out forwards; }
    @keyframes c-fall{ 0%{transform:translate(0,0) rotate(0deg) scale(1);opacity:1} 100%{transform:translate(var(--cx),var(--cy)) rotate(720deg) scale(.3);opacity:0} }
    .ad-finish-emoji{ text-align:center;font-size:20px;letter-spacing:8px;margin-bottom:6px;animation:em-bounce .6s ease-out; }
    @keyframes em-bounce{ 0%{transform:scale(0)} 60%{transform:scale(1.2)} 100%{transform:scale(1)} }
    .ad-open-btn{ display:flex;justify-content:space-between;align-items:center;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.07);border-radius:16px;padding:16px 20px;position:relative;overflow:hidden;color:white;cursor:pointer;-webkit-touch-callout:none;user-select:none;-webkit-user-select:none;transition:transform .2s cubic-bezier(.34,1.56,.64,1); }
    .ad-open-btn::before{ content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(0,255,224,.04),rgba(155,0,255,.04));opacity:0;transition:opacity .3s; }
    .ad-open-btn:active::before{ opacity:1; }
    .ad-open-bar{ position:absolute;left:0;top:15%;bottom:15%;width:3px;background:linear-gradient(180deg,var(--cyan),var(--purple));box-shadow:0 0 10px var(--cyan);border-radius:0 3px 3px 0; }
    .ad-open-lbl{ font-weight:700;font-size:12px;letter-spacing:1.5px;text-transform:uppercase;color:rgba(255,255,255,.9);text-align:left; }
    .ad-open-sub{ font-size:10px;color:rgba(255,255,255,.35);margin-top:3px;font-weight:300;letter-spacing:1px;text-align:left; }
    .ad-open-icon{ width:42px;height:42px;background:linear-gradient(135deg,rgba(0,255,224,.1),rgba(155,0,255,.1));border-radius:12px;border:1px solid rgba(0,255,224,.2);display:flex;align-items:center;justify-content:center; }
    .ad-open-icon i{ font-size:18px;background:linear-gradient(135deg,var(--cyan),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent;filter:drop-shadow(0 0 6px rgba(0,255,224,.6)); }

    /* MAIN CARD */
    .card{ width:92%;max-width:400px;background:var(--glass);backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);border-radius:28px;padding:28px 20px;border:1px solid rgba(255,255,255,.06);text-align:center;position:relative;animation:fiu .8s ease both .5s; }
    .card::before,.card::after{ content:'';position:absolute;width:24px;height:24px;border-color:var(--cyan);border-style:solid; }
    .card::before{ top:-1px;left:-1px;border-width:2px 0 0 2px;border-radius:8px 0 0 0; }
    .card::after{  bottom:-1px;right:-1px;border-width:0 2px 2px 0;border-radius:0 0 8px 0; }
    .hub-btn{ background:linear-gradient(135deg,rgba(0,200,180,.08),rgba(0,100,150,.08));border:1px solid rgba(0,255,224,.15);border-radius:16px;padding:15px 18px;display:flex;align-items:center;justify-content:space-between;text-decoration:none;color:white;margin-bottom:28px;position:relative;overflow:hidden;transition:transform .2s cubic-bezier(.34,1.56,.64,1); }
    .hub-btn::before{ content:'';position:absolute;inset:0;background:linear-gradient(135deg,transparent,rgba(0,255,224,.06));opacity:0;transition:opacity .3s; }
    .hub-btn:active::before{ opacity:1; }
    .hub-accent{ position:absolute;left:0;top:0;bottom:0;width:3px;background:linear-gradient(180deg,var(--cyan),var(--purple));border-radius:3px 0 0 3px;box-shadow:0 0 12px var(--cyan);animation:ap 2s ease-in-out infinite; }
    @keyframes ap{ 0%,100%{box-shadow:0 0 8px var(--cyan)} 50%{box-shadow:0 0 20px var(--cyan),0 0 40px var(--purple)} }
    .hub-text{ display:flex;align-items:center;gap:10px;font-weight:700;font-size:12px;letter-spacing:1.5px;text-transform:uppercase; }
    .tg-icon{ font-size:20px;color:var(--cyan);filter:drop-shadow(0 0 8px var(--cyan));animation:ib 3s ease-in-out infinite; }
    @keyframes ib{ 0%,100%{transform:translateY(0)} 50%{transform:translateY(-4px)} }
    .hub-arr{ width:32px;height:32px;border-radius:50%;background:rgba(0,255,224,.1);border:1px solid rgba(0,255,224,.3);display:flex;align-items:center;justify-content:center;color:var(--cyan);font-size:12px; }
    .title-section{ margin-bottom:20px;display:none;animation:fiu .6s ease both;text-align:center;padding:4px 0; }
    .title-lbl{ font-size:8px;letter-spacing:5px;color:rgba(255,255,255,.25);text-transform:uppercase;margin-bottom:8px; }
    .title-div{ display:flex;align-items:center;gap:10px;margin-bottom:8px;padding:0 10px; }
    .title-div::before,.title-div::after{ content:'';flex:1;height:1px;background:linear-gradient(90deg,transparent,var(--pink),transparent); }
    .title-ico{ font-size:11px;color:var(--pink);filter:drop-shadow(0 0 6px var(--pink));animation:ib 3s ease-in-out infinite; }
    .title-val{ font-family:'Rajdhani',sans-serif;font-size:clamp(16px,5vw,22px);font-weight:700;letter-spacing:3px;text-transform:uppercase;background:linear-gradient(135deg,white 30%,var(--cyan) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;word-break:break-word;line-height:1.2;padding:0 8px; }
    .btn-container{ position:relative;width:160px;height:160px;margin:0 auto 28px; }
    @keyframes bhr{ 0%{transform:scale(1);opacity:1} 40%{transform:scale(1.65);opacity:.2} 60%{transform:scale(1.65);opacity:0} 61%{transform:scale(.8);opacity:0} 85%{transform:scale(.8);opacity:.9} 100%{transform:scale(1);opacity:1} }
    .bh-firing .orbit-outer,.bh-firing .orbit-inner,.bh-firing .orbit-dot,.bh-firing .orbit-dot2{ animation:bhr .8s ease forwards !important; }
    @keyframes bh-img{ 0%{transform:scale(1) rotate(0deg);filter:brightness(1);opacity:1} 20%{transform:scale(.88) rotate(180deg);filter:brightness(.85);opacity:1} 45%{transform:scale(.6) rotate(540deg);filter:brightness(.55) blur(1px) saturate(.5);opacity:.8} 68%{transform:scale(.18) rotate(900deg);filter:brightness(.15) blur(3px) saturate(0);opacity:.3} 78%{transform:scale(0) rotate(1080deg);filter:brightness(0) blur(6px);opacity:0} 79%{transform:scale(0);opacity:0} 90%{transform:scale(1.1);opacity:1;filter:brightness(1.5)} 100%{transform:scale(1);opacity:1;filter:brightness(1)} }
    #main-btn.bh-fire{ animation:bh-img 1.2s cubic-bezier(.4,0,.55,1) forwards !important; }
    @keyframes os{ to{transform:rotate(360deg)} }
    @keyframes osr{ to{transform:rotate(-360deg)} }
    .orbit-outer{ position:absolute;inset:-4px;border-radius:50%;border:4px solid transparent;background:linear-gradient(var(--bg),var(--bg)) padding-box,conic-gradient(var(--cyan) 0deg,transparent 110deg,var(--pink) 180deg,transparent 290deg,var(--cyan) 360deg) border-box;animation:os 3s linear infinite;box-shadow:0 0 20px rgba(0,255,224,.35); }
    .orbit-inner{ position:absolute;inset:8px;border-radius:50%;border:3px solid transparent;background:linear-gradient(var(--bg),var(--bg)) padding-box,conic-gradient(var(--orange) 0deg,transparent 110deg,var(--purple) 200deg,transparent 300deg,var(--orange) 360deg) border-box;animation:osr 2s linear infinite;box-shadow:0 0 16px rgba(255,106,0,.35); }
    .orbit-dot{ position:absolute;inset:-10px;animation:os 2.5s linear infinite;border-radius:50%; }
    .orbit-dot::before{ content:'';position:absolute;top:50%;left:0;width:13px;height:13px;background:radial-gradient(circle,white 0%,var(--cyan) 50%,transparent 70%);border-radius:50%;transform:translateY(-50%);box-shadow:0 0 18px var(--cyan); }
    .orbit-dot::after{  content:'';position:absolute;top:50%;left:9px;width:44px;height:2.5px;background:linear-gradient(90deg,rgba(0,255,224,.55),transparent);border-radius:2px;transform:translateY(-50%); }
    .orbit-dot2{ position:absolute;inset:2px;animation:osr 1.8s linear infinite;border-radius:50%; }
    .orbit-dot2::before{ content:'';position:absolute;top:50%;right:0;width:11px;height:11px;background:radial-gradient(circle,white 0%,var(--pink) 50%,transparent 70%);border-radius:50%;transform:translateY(-50%);box-shadow:0 0 16px var(--pink); }
    .orbit-dot2::after{  content:'';position:absolute;top:50%;right:9px;width:34px;height:2px;background:linear-gradient(270deg,rgba(255,0,122,.55),transparent);border-radius:2px;transform:translateY(-50%); }
    .glow-ring{ position:absolute;inset:-14px;border-radius:50%;border:1px solid rgba(255,106,0,.2);animation:gp 2s ease-in-out infinite; }
    @keyframes gp{ 0%,100%{transform:scale(1);opacity:.4;box-shadow:none} 50%{transform:scale(1.04);opacity:.8;box-shadow:0 0 30px rgba(255,106,0,.3)} }
    .start-btn{ position:absolute;inset:18px;background:url('https://files.catbox.moe/52799g.jpg') center/cover;border-radius:50%;cursor:pointer;display:flex;align-items:flex-end;justify-content:center;font-weight:900;font-size:12px;letter-spacing:3px;color:white;overflow:hidden;transition:transform .2s cubic-bezier(.34,1.56,.64,1);border:2px solid rgba(255,255,255,.15); }
    .start-btn::after{ content:'';position:absolute;top:-50%;left:-60%;width:50%;height:200%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.15),transparent);transform:skewX(-20deg);animation:shine 4s ease-in-out infinite; }
    @keyframes shine{ 0%,100%{left:-60%;opacity:0} 50%{left:160%;opacity:1} }
    .start-lbl{ position:relative;z-index:2;padding-bottom:10px;text-shadow:0 2px 12px rgba(0,0,0,.9); }
    .actions{ display:flex;flex-direction:column;gap:12px; }
    .btn-modern{ background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.07);border-radius:16px;padding:16px 20px;display:flex;justify-content:space-between;align-items:center;text-decoration:none;position:relative;overflow:hidden;transition:transform .2s cubic-bezier(.34,1.56,.64,1); }
    .btn-modern::before{ content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(255,106,0,.06),rgba(155,0,255,.06));opacity:0;transition:opacity .3s; }
    .btn-modern:active::before{ opacity:1; }
    .btn-accent{ position:absolute;left:0;top:15%;bottom:15%;width:3px;background:linear-gradient(180deg,var(--orange),var(--pink));box-shadow:0 0 10px var(--orange);border-radius:0 3px 3px 0; }
    .btn-lbl{ font-weight:700;font-size:12px;letter-spacing:1.5px;text-transform:uppercase;color:rgba(255,255,255,.9);text-align:left; }
    .btn-sub{ font-size:10px;color:rgba(255,255,255,.35);margin-top:3px;font-weight:300;letter-spacing:1px; }
    .btn-ico{ width:42px;height:42px;background:rgba(255,255,255,.05);border-radius:12px;border:1px solid rgba(255,255,255,.08);display:flex;align-items:center;justify-content:center; }
    .btn-ico i{ font-size:18px;background:linear-gradient(135deg,var(--orange),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent;filter:drop-shadow(0 0 6px rgba(255,106,0,.6)); }
    .btn-modern:nth-child(2) .btn-accent{ background:linear-gradient(180deg,var(--cyan),var(--purple));box-shadow:0 0 10px var(--cyan); }
    .btn-modern:nth-child(2) .btn-ico i{ background:linear-gradient(135deg,var(--cyan),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent;filter:drop-shadow(0 0 6px rgba(0,255,224,.6)); }
    .status-bar{ margin-top:28px;display:flex;align-items:center;justify-content:center;gap:8px; }
    .status-dot{ width:6px;height:6px;border-radius:50%;background:var(--cyan);box-shadow:0 0 8px var(--cyan);animation:blink 2s ease-in-out infinite; }
    .status-txt{ font-size:9px;letter-spacing:3px;color:rgba(255,255,255,.2);font-weight:600;text-transform:uppercase; }
    .card-bottom{ margin-top:14px;margin-bottom:24px; }
    .how-btn{ display:flex;align-items:center;justify-content:space-between;text-decoration:none;color:white;margin-top:20px;position:relative;overflow:hidden;padding:14px 16px;transition:transform .2s cubic-bezier(.34,1.56,.64,1); }
    .how-btn:active{ transform:scale(.97); }
    .how-left{ display:flex;align-items:center;gap:14px;position:relative;z-index:2; }
    .how-title{ font-weight:800;font-size:12px;letter-spacing:1px;text-transform:uppercase;margin-bottom:3px; }
    .how-sub-lbl{ font-size:10px;letter-spacing:1px; }
    .how-icon{ width:44px;height:44px;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0; }
    .how-arr{ display:flex;align-items:center;justify-content:center;width:32px;height:32px;font-size:11px;z-index:2;animation:ha 2s ease-in-out infinite; }
    @keyframes ha{ 0%,100%{transform:translateX(0)} 50%{transform:translateX(4px)} }
    @keyframes slid{ to{background-position:200% 0} }
    .s5-wrap{ margin-top:20px;padding:2px;border-radius:18px;background:linear-gradient(135deg,var(--orange),var(--pink),var(--purple),var(--cyan),var(--orange));background-size:300% 300%;animation:rs 4s linear infinite; }
    @keyframes rs{ to{background-position:300% 300%} }
    .s5-wrap .how-btn{ margin-top:0;background:#0a0618;border-radius:17px; }
    .s5-wrap .how-icon{ border-radius:50%;background:linear-gradient(135deg,var(--orange),var(--pink));box-shadow:0 0 16px rgba(255,106,0,.4);color:white; }
    .s5-wrap .how-title{ background:linear-gradient(90deg,var(--orange),var(--pink),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;background-size:200%;animation:slid 3s linear infinite; }
    .s5-wrap .how-sub-lbl{ color:rgba(255,255,255,.35); }
    .s5-wrap .how-arr{ color:var(--pink); }
    .s7{ background:linear-gradient(135deg,rgba(255,200,0,.04),rgba(255,106,0,.04));border:1px solid rgba(255,200,0,.22);border-radius:18px;box-shadow:0 0 20px rgba(255,200,0,.06); }
    .s7::before{ content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,#ffd700,var(--orange),transparent);background-size:200% 100%;animation:slid 3s linear infinite; }
    .s7 .how-icon{ border-radius:50%;background:linear-gradient(135deg,rgba(255,200,0,.15),rgba(255,106,0,.1));border:1.5px solid rgba(255,200,0,.4);color:#ffd700;box-shadow:0 0 16px rgba(255,200,0,.25); }
    .s7 .how-title{ background:linear-gradient(90deg,#ffd700,var(--orange));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text; }
    .s7 .how-sub-lbl{ color:rgba(255,200,0,.45); }
    .s7 .how-arr{ color:#ffd700; }
    .click-active{ transform:scale(.93) !important;transition:transform .08s ease-out !important; }
    .fp{ position:fixed;pointer-events:none;border-radius:50%;z-index:10000;animation:fb var(--dur,.7s) ease-out forwards; }
    @keyframes fb{ 0%{transform:translate(-50%,-50%) scale(1);opacity:1} 100%{transform:translate(calc(-50% + var(--tx)),calc(-50% + var(--ty))) scale(0);opacity:0} }
    .cr{ position:fixed;width:10px;height:10px;border-radius:50%;border:2px solid var(--cyan);pointer-events:none;z-index:9999;animation:re .5s ease-out forwards; }
    @keyframes re{ 0%{transform:translate(-50%,-50%) scale(1);opacity:.8} 100%{transform:translate(-50%,-50%) scale(12);opacity:0} }
    .sparkle{ position:fixed;border-radius:50%;pointer-events:none;z-index:0;animation:sr linear forwards; }
    @keyframes sr{ 0%{transform:translateY(0) scale(1);opacity:.8} 100%{transform:translateY(-100vh) scale(.3);opacity:0} }
    .ct{ position:fixed;width:6px;height:6px;border-radius:50%;pointer-events:none;z-index:9998;animation:tf .6s ease-out forwards; }
    @keyframes tf{ 0%{transform:translate(-50%,-50%) scale(1);opacity:.7} 100%{transform:translate(-50%,-50%) scale(0);opacity:0} }
    ::-webkit-scrollbar{ width:4px; }
    ::-webkit-scrollbar-thumb{ background:var(--pink);border-radius:2px; }
    </style>
</head>
<body>
<audio id="snd" preload="auto"></audio>
<div class="bg-scene"></div>
<div class="orb orb-1"></div><div class="orb orb-2"></div><div class="orb orb-3"></div>
<div class="scan-line"></div>

<!-- TOKEN MODAL -->
<div id="token-modal" class="modal-overlay hidden">
    <div class="token-box">
        <div class="tk-title">üîë ACCESS CODE</div>
        <div class="tk-sub">Enter your ad-free access token</div>
        <div id="tk-input-panel" class="tk-input-panel">
            <input type="text" id="tk-input" class="tk-input" placeholder="Paste the code here...">
            <button id="tk-submit" class="tk-btn">‚ú¶ Verify Code</button>
            <div id="tk-msg" class="tk-msg"></div>
        </div>
        <div id="tk-status" class="tk-status">
            <div class="tk-badge"><div class="tk-dot"></div><div class="tk-badge-lbl">AD-FREE ACTIVE</div></div>
            <div class="tk-time" id="tk-time">--:--:--</div>
            <div class="tk-time-sub">Time Remaining</div>
        </div>
        <button id="tk-close" class="tk-close">‚úï Close</button>
    </div>
</div>

<!-- AD OVERLAY -->
<div id="ad-overlay" class="ad-overlay hidden">
    <div class="ad-topbar">
        <div class="ad-topbar-brand">ANIME FANZ FZ</div>
        <div class="ad-topbar-dots" id="ad-top-dots"></div>
    </div>
    <div class="ad-note">
        <div class="ad-note-text">
            <span>üôè Please cooperate with us</span><br>
            These ads help us bring you anime regularly &amp; keep the platform free.<br>
            <span>Your support keeps us going ‚Äî thank you! ‚ú®</span>
        </div>
    </div>
    <div class="ad-counter-wrap">
        <div class="ad-counter-num" id="ad-counter">1 OF 1</div>
        <div class="ad-counter-bar"><div class="ad-counter-fill" id="ad-fill" style="width:0%"></div></div>
    </div>
    <div class="ad-card" id="ad-card"></div>
    <div class="ad-timer-wrap">
        <div class="ad-timer-ring">
            <svg width="56" height="56" viewBox="0 0 56 56">
                <circle class="trk" cx="28" cy="28" r="23"/>
                <circle class="prg" id="timer-circle" cx="28" cy="28" r="23" stroke-dasharray="144.51" stroke-dashoffset="0"/>
            </svg>
            <div class="ad-timer-num" id="timer-num">10</div>
        </div>
        <div class="ad-timer-lbl">seconds remaining</div>
    </div>
    <button id="ad-continue" class="ad-continue">Continue ‚Üí</button>
    <div id="ad-finish" class="ad-finish">
        <div class="ad-finish-emoji">üéâ &nbsp; üéä &nbsp; üéâ</div>
        <div class="confetti-side confetti-left"  id="cf-left"></div>
        <div class="confetti-side confetti-right" id="cf-right"></div>
        <div id="ad-open-btn" class="ad-open-btn" oncontextmenu="return false">
            <span class="ad-open-bar"></span>
            <div><div class="ad-open-lbl">Open Anime üéå</div><div class="ad-open-sub">All ads done ‚Äî enjoy! ‚ú®</div></div>
            <div class="ad-open-icon"><i class="fas fa-play"></i></div>
        </div>
    </div>
</div>

<!-- HEADER -->
<div class="header">
    <div class="header-slash"></div>
    <div class="logo-wrap">
        <div class="logo-tag">‚Äî Official Portal ‚Äî</div>
        <h1 class="main-title" data-text="ANIME FANZ FZ">ANIME FANZ FZ</h1>
        <div class="logo-sub">‚ú¶ Your Ultimate Anime Source ‚ú¶</div>
    </div>
    <div class="key-wrap" id="key-icon"><i class="fas fa-key"></i></div>
    <div class="header-bottom-clip"></div>
</div>

<!-- MAIN CARD -->
<div class="card">
    <a href="https://t.me/+bxLawCRx2pw0MjU1" class="hub-btn tap-btn">
        <span class="hub-accent"></span>
        <div class="hub-text"><i class="fab fa-telegram tg-icon"></i><span>Access Our Telegram Hub</span></div>
        <div class="hub-arr"><i class="fas fa-bolt"></i></div>
    </a>
    <div class="title-section" id="title-section">
        <div class="title-lbl">Title</div>
        <div class="title-div"><div class="title-ico">‚ú¶</div></div>
        <div class="title-val" id="title-text">‚Äî</div>
    </div>
    <div class="btn-container">
        <div class="glow-ring"></div>
        <div class="orbit-outer"></div>
        <div class="orbit-inner"></div>
        <div class="orbit-dot"></div>
        <div class="orbit-dot2"></div>
        <div id="main-btn" class="start-btn"><span class="start-lbl">START</span></div>
    </div>
    <div id="how-container"></div>
</div>

<!-- BOTTOM CARD -->
<div class="card card-bottom">
    <div class="actions">
        <a href="http://t.me/Anime_Fanz_Fzbot" class="btn-modern tap-btn">
            <span class="btn-accent"></span>
            <div><div class="btn-lbl">Contact Admin</div><div class="btn-sub">Direct support üí´</div></div>
            <div class="btn-ico"><i class="fas fa-user-shield"></i></div>
        </a>
        <a href="https://t.me/+g6PUdKTHp5FhZDJl" class="btn-modern tap-btn">
            <span class="btn-accent"></span>
            <div><div class="btn-lbl">Support Group</div><div class="btn-sub">Community hub üå∏</div></div>
            <div class="btn-ico"><i class="fas fa-satellite-dish"></i></div>
        </a>
    </div>
    <div class="status-bar">
        <span class="status-dot"></span>
        <span class="status-txt">Powered By @Anime_Fanz_Fz</span>
        <span class="status-dot"></span>
    </div>
</div>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ‚öôÔ∏è CONFIG ‚Äî EDIT KARO YAHAN
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

   ‚ö†Ô∏è  VALID_EPOCH ‚Äî Jab /revokealltoken use karo tab
       bot batayega konsi value dalni hai yahan.
       Bot command: /revokealltoken
       Bot bata dega: "VALID_EPOCH ko X karo"

   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

const AD_TIMER_SECONDS = 10;

const DEFAULT_ADS = [
    "https://example.com/ad1",
    "https://example.com/ad2",
    "https://example.com/ad3",
];

// ‚ö†Ô∏è BOT KE HMAC_SECRET_BASE SE EXACTLY MATCH KARO
const HMAC_SECRET_BASE = "AnImEfAnZfZ_S3CR3T_2026";

// ‚ö†Ô∏è /revokealltoken ke baad bot jo value bataye woh yahan daalo
const VALID_EPOCH = 0;   // ‚Üê EDIT WHEN BOT SAYS TO

// HMAC_SECRET = base + epoch (bot ke saath sync)
const HMAC_SECRET = HMAC_SECRET_BASE + ":" + VALID_EPOCH;

const BOT_TOKEN = "8554751496:AAG7EsWinx_2MA-kFMJL77rmdao55ha4VaE";
const ADMIN_ID  = "6196038042";

const IMAGE_LIST = [
    "https://files.catbox.moe/52799g.jpg",
    "https://h.uguu.se/rgMFcpPL.jpg",
    "https://d.uguu.se/ePknqxai.jpg",
    "https://h.uguu.se/epfDuMxw.jpg",
    "https://n.uguu.se/apxjBadN.jpg",
    "https://n.uguu.se/pSTCYiAl.jpg",
    "https://o.uguu.se/DinJjEqt.jpg",
    "https://d.uguu.se/YXmCyGiz.jpg",
    "https://h.uguu.se/PmhUWkdV.jpg",
    "https://n.uguu.se/pvBSwrrs.jpg",
    "https://d.uguu.se/EGKsuqgj.jpg",
    "https://n.uguu.se/AlEUvKsC.jpg",
    "https://h.uguu.se/MBdUrwvb.jpg",
    "https://n.uguu.se/GDkczBwl.gif",
    "https://d.uguu.se/bGRgCvrx.jpg",
];

const SOUND_LIST = [
    "https://files.catbox.moe/6h33lc.mp3","https://files.catbox.moe/wzj0v9.mp3",
    "https://files.catbox.moe/axmlfj.mp3","https://files.catbox.moe/5bt3eg.mp3",
    "https://files.catbox.moe/db4by6.mp3","https://files.catbox.moe/2asf5w.mp3",
    "https://files.catbox.moe/f7pwz9.mp3",
];

const SETTINGS = { rest:300, err:'Link Expired!', particles:14, sparkle:180 };

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   üìä ANALYTICS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function pingBot(event) {
    fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
        method:"POST", headers:{"Content-Type":"application/json"},
        body: JSON.stringify({ chat_id: ADMIN_ID, text: "AFZSTAT:" + event })
    }).catch(() => {});
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   üîê HMAC HELPERS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const _enc = new TextEncoder();

async function hmacHex(secret, message, length) {
    const key = await crypto.subtle.importKey(
        "raw", _enc.encode(secret), { name:"HMAC", hash:"SHA-256" }, false, ["sign"]
    );
    const sig = await crypto.subtle.sign("HMAC", key, _enc.encode(message));
    return Array.from(new Uint8Array(sig))
        .map(b => b.toString(16).padStart(2,"0"))
        .join("")
        .substring(0, length)
        .toUpperCase();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   üîê URL SIGNATURE VERIFICATION
   Bot se bane links verify karta hai.
   Manually banaya hua link NAHI chalega.
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
async function verifyUrlSignature(targetB64, titleEnc, adsParam, sig) {
    if (!sig) return false;
    const payload  = `${targetB64}:${titleEnc || ""}:${adsParam || ""}`;
    const expected = await hmacHex(HMAC_SECRET, payload, 16);
    return sig.toUpperCase() === expected;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   üîë TOKEN SYSTEM
   New format: AFZ-{expiry}-{uid}-{hmac12}
   uid=0 ‚Üí generic, uid=TelegramID ‚Üí bound to user
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const TOKEN_KEY = "afz_tok_v4";  // v4 = new format

async function verifyToken(raw) {
    const parts = raw.trim().toUpperCase().split("-");
    if (parts.length !== 4 || parts[0] !== "AFZ") return { ok:false, reason:"Invalid format" };

    const expiry = parseInt(parts[1]);
    const uid    = parseInt(parts[2]);
    const sig    = parts[3];

    if (isNaN(expiry) || isNaN(uid)) return { ok:false, reason:"Invalid format" };

    // Check expiry
    if (expiry !== 0 && Date.now() / 1000 > expiry) return { ok:false, reason:"Token expired" };

    // Verify HMAC (epoch is included via HMAC_SECRET)
    const payload  = `${expiry}:${uid}:${VALID_EPOCH}`;
    const expected = await hmacHex(HMAC_SECRET, payload, 12);
    if (expected !== sig) return { ok:false, reason:"Invalid or revoked token" };

    // Check user ID binding
    // uid=0 ‚Üí generic (any user)
    // uid>0 ‚Üí must match THIS user's Telegram ID
    if (uid !== 0) {
        const tgUser = window.Telegram?.WebApp?.initDataUnsafe?.user;
        const myId   = tgUser ? String(tgUser.id) : null;
        if (!myId || String(uid) !== myId) {
            return { ok:false, reason:"Token belongs to another user" };
        }
    }

    return { ok:true, expiry, uid };
}

function saveToken(raw, expiry, uid) {
    localStorage.setItem(TOKEN_KEY, JSON.stringify({
        raw: raw.toUpperCase(), expiry, uid, savedAt: Date.now(), epoch: VALID_EPOCH
    }));
}
function getToken() {
    try { return JSON.parse(localStorage.getItem(TOKEN_KEY)); } catch { return null; }
}
function clearToken() { localStorage.removeItem(TOKEN_KEY); }

function isAdFreeUser() {
    const t = getToken();
    if (!t) return false;
    // If token was saved under a different epoch, it's revoked
    if ((t.epoch || 0) < VALID_EPOCH) { clearToken(); return false; }
    if (t.expiry === 0) return true;
    if (Date.now() / 1000 > t.expiry) { clearToken(); return false; }
    return true;
}

function formatTimeLeft(expiry) {
    if (expiry === 0) return "PERMANENT ‚ôæ";
    const diff = expiry - Date.now() / 1000;
    if (diff <= 0) return "EXPIRED";
    const d = Math.floor(diff / 86400), h = Math.floor((diff % 86400) / 3600);
    const m = Math.floor((diff % 3600) / 60), s = Math.floor(diff % 60);
    if (d > 0) return `${d}d ${h}h ${m}m`;
    if (h > 0) return `${h}h ${m}m ${s}s`;
    return `${m}m ${s}s`;
}

function updateKeyIcon() {
    const el = document.getElementById("key-icon");
    if (isAdFreeUser()) {
        el.classList.add("active");
        el.querySelector("i").className = "fas fa-shield-alt";
    } else {
        el.classList.remove("active");
        el.querySelector("i").className = "fas fa-key";
    }
}

let tokenCdInt = null;

document.getElementById("key-icon").addEventListener("click", () => {
    document.getElementById("token-modal").classList.remove("hidden");
    if (isAdFreeUser()) {
        document.getElementById("tk-input-panel").style.display = "none";
        document.getElementById("tk-status").classList.add("show");
        clearInterval(tokenCdInt);
        const t = getToken();
        const upd = () => document.getElementById("tk-time").textContent = formatTimeLeft(t.expiry);
        upd(); tokenCdInt = setInterval(upd, 1000);
    } else {
        document.getElementById("tk-input-panel").style.display = "block";
        document.getElementById("tk-status").classList.remove("show");
        document.getElementById("tk-input").focus();
    }
});

document.getElementById("tk-close").addEventListener("click", () => {
    document.getElementById("token-modal").classList.add("hidden");
    document.getElementById("tk-msg").textContent = "";
    document.getElementById("tk-input").value = "";
    clearInterval(tokenCdInt);
});

document.getElementById("tk-submit").addEventListener("click", async () => {
    const val   = document.getElementById("tk-input").value.trim();
    const msgEl = document.getElementById("tk-msg");
    if (!val) { msgEl.textContent = "‚ö†Ô∏è Code empty hai!"; msgEl.className = "tk-msg err"; return; }
    const result = await verifyToken(val);
    if (!result.ok) {
        msgEl.textContent = "‚ùå " + result.reason;
        msgEl.className = "tk-msg err";
        return;
    }
    saveToken(val, result.expiry, result.uid);
    updateKeyIcon();
    const label = result.expiry === 0 ? "Permanent Ad-Free active! üéå" : "Ad-Free active! Enjoy üéå";
    msgEl.textContent = "‚úÖ " + label;
    msgEl.className = "tk-msg ok";
    setTimeout(() => document.getElementById("token-modal").classList.add("hidden"), 1600);
});

updateKeyIcon();
setInterval(updateKeyIcon, 60000);

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   üì∫ AD SYSTEM
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let adList = [], adIdx = 0, destUrl = "", adTimerInt = null, adSec = 0, videoMuted = false;

function isVideo(url) {
    return [".mp4",".webm",".ogg",".mov",".m4v"].some(e => url.toLowerCase().includes(e));
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   üîê ADS PARAM PARSING
   New format from bot:
   - Ad-Free: AFZF-{hmac16}
   - Custom:  AFZA.{encrypted_b64}.{hmac12}
   - Old "free" or plain base64: REJECTED
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

// XOR decrypt (same key derivation as bot.py)
async function decryptAds(encB64) {
    try {
        // Derive key
        const keyBytes = new Uint8Array(await crypto.subtle.sign(
            "HMAC",
            await crypto.subtle.importKey("raw", _enc.encode(HMAC_SECRET), {name:"HMAC",hash:"SHA-256"}, false, ["sign"]),
            _enc.encode("ads_encrypt")
        ));
        // Decode base64 (URL-safe, no padding)
        const padded  = encB64.replace(/-/g, '+').replace(/_/g, '/') + "==".slice((encB64.length + 2) % 4 === 0 ? 4 : (encB64.length + 2) % 4);
        const decoded = Uint8Array.from(atob(padded), c => c.charCodeAt(0));
        // XOR decrypt
        const plain   = new Uint8Array(decoded.length);
        for (let i = 0; i < decoded.length; i++) plain[i] = decoded[i] ^ keyBytes[i % 32];
        return JSON.parse(new TextDecoder().decode(plain));
    } catch (e) { return null; }
}

async function parseAdsParam(adsParam, targetB64) {
    if (!adsParam) return { mode:"default" };

    // ‚îÄ‚îÄ Ad-Free: AFZF-{hmac16} ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    if (adsParam.startsWith("AFZF-")) {
        const sig      = adsParam.substring(5);
        const expected = await hmacHex(HMAC_SECRET, `adfree:${targetB64}`, 16);
        if (sig.toUpperCase() === expected) return { mode:"free" };
        return { mode:"invalid" };
    }

    // ‚îÄ‚îÄ Custom Ads: AFZA.{enc}.{hmac12} ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    if (adsParam.startsWith("AFZA.")) {
        const inner = adsParam.substring(5); // strip "AFZA."
        const dot   = inner.lastIndexOf(".");
        if (dot === -1) return { mode:"invalid" };
        const encB64 = inner.substring(0, dot);
        const sig    = inner.substring(dot + 1);
        // Verify signature
        const expected = await hmacHex(HMAC_SECRET, `ads:${targetB64}:${encB64}`, 12);
        if (sig.toUpperCase() !== expected) return { mode:"invalid" };
        // Decrypt ads
        const ads = await decryptAds(encB64);
        if (!ads || !Array.isArray(ads) || ads.length === 0) return { mode:"invalid" };
        return { mode:"custom", ads };
    }

    // ‚îÄ‚îÄ Old/manual formats ‚Üí REJECT (security) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // Someone manually added &ads=free or old base64 ‚Üí not accepted
    return { mode:"invalid" };
}

function buildDots(total, cur) {
    const el = document.getElementById("ad-top-dots");
    el.innerHTML = "";
    for (let i=0; i<total; i++) {
        const d = document.createElement("div");
        d.className = "ad-dot" + (i < cur ? " done" : i===cur ? " active" : "");
        el.appendChild(d);
    }
    document.getElementById("ad-fill").style.width = ((cur+1)/total*100) + "%";
}

function showAdPage(idx) {
    const total = adList.length;
    adIdx = idx;
    document.getElementById("ad-counter").textContent = `${idx+1} OF ${total}`;
    buildDots(total, idx);
    const card = document.getElementById("ad-card");
    const url  = adList[idx];
    if (isVideo(url)) {
        card.innerHTML = `<video class="ad-video" id="ad-vid" src="${url}" autoplay playsinline loop></video><div class="ad-mute" id="ad-mute"><i class="fas fa-volume-up"></i></div>`;
        const vid = document.getElementById("ad-vid");
        const mb  = document.getElementById("ad-mute");
        vid.muted = videoMuted;
        mb.querySelector("i").className = videoMuted ? "fas fa-volume-mute" : "fas fa-volume-up";
        mb.addEventListener("click", () => { videoMuted=!videoMuted; vid.muted=videoMuted; mb.querySelector("i").className=videoMuted?"fas fa-volume-mute":"fas fa-volume-up"; });
    } else {
        card.innerHTML = `<div class="ad-link-inner"><div class="ad-tv-icon">üì∫</div><div class="ad-link-num">AD ${idx+1} OF ${total}</div><div class="ad-link-desc">Please visit <a class="ad-hyperlink" href="${url}" target="_blank" rel="noopener noreferrer">AD LINK</a><br>then come back and wait for the timer.<br>Press <b>Continue</b> when ready.</div></div>`;
        setTimeout(() => window.open(url, "_blank"), 350);
        pingBot("adclick");
    }
    document.getElementById("ad-continue").classList.remove("show");
    document.getElementById("ad-finish").classList.remove("show");
    startTimer(idx, total);
}

function startTimer(idx, total) {
    clearInterval(adTimerInt);
    adSec = AD_TIMER_SECONDS;
    const circ = 144.51;
    const cEl  = document.getElementById("timer-circle");
    const nEl  = document.getElementById("timer-num");
    function tick() {
        nEl.textContent = adSec;
        cEl.style.strokeDashoffset = circ - (adSec / AD_TIMER_SECONDS) * circ;
        if (adSec <= 0) {
            clearInterval(adTimerInt);
            if (idx + 1 < total) document.getElementById("ad-continue").classList.add("show");
            else showFinish();
        }
        adSec--;
    }
    tick(); adTimerInt = setInterval(tick, 1000);
}

function showFinish() {
    document.getElementById("ad-finish").classList.add("show");
    document.getElementById("ad-open-btn").dataset.url = destUrl;
    launchConfetti();
}

function launchConfetti() {
    const cols = ["#ff6a00","#ff007a","#00ffe0","#9b00ff","#ffd700","#fff"];
    ["cf-left","cf-right"].forEach((id, side) => {
        const el = document.getElementById(id); el.innerHTML = "";
        for (let i=0; i<12; i++) {
            const p = document.createElement("div"); p.className = "confetti-piece";
            const cx = (side===0?1:-1)*(Math.random()*80+20), cy = -(Math.random()*120+40);
            p.style.cssText = `background:${cols[Math.floor(Math.random()*cols.length)]};left:${Math.random()*30}px;top:${Math.random()*20}px;width:${Math.random()*8+4}px;height:${Math.random()*8+4}px;--cx:${cx}px;--cy:${cy}px;animation-delay:${Math.random()*.4}s;animation-duration:${Math.random()*.5+.9}s;`;
            el.appendChild(p);
        }
    });
}

function startAdFlow(ads, url) {
    adList = ads; destUrl = url;
    document.getElementById("ad-overlay").classList.remove("hidden");
    showAdPage(0);
}

document.getElementById("ad-continue").addEventListener("click", () => {
    playSound();
    if (adIdx + 1 < adList.length) showAdPage(adIdx + 1);
});

document.getElementById("ad-open-btn").addEventListener("click", function(e) {
    playSound();
    spawnParticles(e.clientX || innerWidth/2, e.clientY || innerHeight/2);
    this.style.transform = "scale(.95)";
    setTimeout(() => { this.style.transform = ""; }, 150);
    const u = this.dataset.url;
    if (u) setTimeout(() => { location.href = u; }, 220);
});

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   TELEGRAM SETUP
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const tg = window.Telegram.WebApp;
tg.expand(); tg.ready();
tg.BackButton.show();
tg.BackButton.onClick(() => tg.close());
const sndEl = document.getElementById("snd");

function playSound() {
    sndEl.src = SOUND_LIST[Math.floor(Math.random() * SOUND_LIST.length)];
    sndEl.currentTime = 0;
    sndEl.play().catch(()=>{});
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   TITLE INIT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
(function(){
    const p = new URLSearchParams(location.search);
    const t = p.get("title");
    if (t && t.trim()) {
        let v = t;
        try { v = decodeURIComponent(t); } catch(e) {}
        document.getElementById("title-text").textContent = v;
        document.getElementById("title-section").style.display = "block";
    }
})();

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   HOW TO OPEN
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
(function(){
    const url = "https://t.me/Anime_fanz_watching/8";
    const s   = Math.random() < .5 ? 5 : 7;
    const inner = `<div class="how-left"><div class="how-icon"><i class="fas fa-play"></i></div><div><div class="how-title">How to open the Anime</div><div class="how-sub-lbl">Tap to learn üé¨</div></div></div><div class="how-arr"><i class="fas fa-chevron-right"></i></div>`;
    document.getElementById("how-container").innerHTML = s===5
        ? `<div class="s5-wrap"><a href="${url}" class="how-btn tap-btn">${inner}</a></div>`
        : `<a href="${url}" class="how-btn s7 tap-btn">${inner}</a>`;
})();

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   IMAGE ROTATION
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let lastImg = 0;
function nextImg() {
    let i; do { i = Math.floor(Math.random()*IMAGE_LIST.length); } while (i===lastImg && IMAGE_LIST.length>1);
    lastImg = i; return IMAGE_LIST[i];
}
document.addEventListener("DOMContentLoaded", () => {
    const b = document.getElementById("main-btn");
    if (b) { lastImg = Math.floor(Math.random()*IMAGE_LIST.length); b.style.backgroundImage = `url('${IMAGE_LIST[lastImg]}')`; }
});

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SPARKLES
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const COLS = ["#ff6a00","#ff007a","#00ffe0","#9b00ff","#fff"];
setInterval(() => {
    const s = document.createElement("div"); s.className = "sparkle";
    const sz = Math.random()*3+2;
    s.style.cssText = `width:${sz}px;height:${sz}px;left:${Math.random()*100}vw;bottom:${Math.random()*20}vh;background:${COLS[Math.floor(Math.random()*COLS.length)]};box-shadow:0 0 8px currentColor;animation-duration:${Math.random()*3+3}s;`;
    document.body.appendChild(s);
    setTimeout(() => s.remove(), 6000);
}, SETTINGS.sparkle);

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   CURSOR TRAIL
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let tc = 0;
document.addEventListener("mousemove", e => {
    if (tc++ % 2 !== 0) return;
    const t = document.createElement("div"); t.className = "ct";
    const c = COLS[Math.floor(Math.random()*COLS.length)];
    t.style.cssText = `left:${e.clientX}px;top:${e.clientY}px;background:${c};box-shadow:0 0 6px ${c};`;
    document.body.appendChild(t); setTimeout(() => t.remove(), 600);
});

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   PARTICLES
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function spawnParticles(cx, cy) {
    const r = document.createElement("div"); r.className = "cr";
    r.style.cssText = `left:${cx}px;top:${cy}px;`;
    document.body.appendChild(r); setTimeout(() => r.remove(), 500);
    const fc = [["#ffcc00","#ff8800","#ff4400"],["#ff00aa","#ff007a","#cc0055"],["#00ffe0","#00aacc","#0077aa"]];
    const pal = fc[Math.floor(Math.random()*fc.length)];
    for (let i=0; i<SETTINGS.particles; i++) {
        const p = document.createElement("div"); p.className = "fp";
        const a = Math.random()*Math.PI*2, v = Math.random()*130+30, sz = Math.random()*7+3;
        const col = pal[Math.floor(Math.random()*pal.length)];
        p.style.cssText = `left:${cx}px;top:${cy}px;width:${sz}px;height:${sz}px;background:${col};box-shadow:0 0 ${sz*2}px ${col};--tx:${Math.cos(a)*v}px;--ty:${Math.sin(a)*v}px;--dur:${Math.random()*.4+.4}s;`;
        document.body.appendChild(p); setTimeout(() => p.remove(), 800);
    }
}
window.addEventListener("click", e => spawnParticles(e.clientX, e.clientY));

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   START BUTTON ‚Äî MAIN LOGIC
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
document.getElementById("main-btn").addEventListener("click", function() {
    playSound();
    if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred("medium");
    this.classList.add("click-active");
    const bc = document.querySelector(".btn-container");
    bc.classList.remove("bh-firing"); this.classList.remove("bh-fire");
    void bc.offsetWidth;
    bc.classList.add("bh-firing"); this.classList.add("bh-fire");
    setTimeout(() => { this.style.backgroundImage = `url('${nextImg()}')`; }, 950);
    setTimeout(() => { bc.classList.remove("bh-firing"); this.classList.remove("bh-fire"); }, 1400);
    const self = this;

    setTimeout(async () => {
        self.classList.remove("click-active");

        const p         = new URLSearchParams(location.search);
        const targetB64 = p.get("target");
        const titleEnc  = p.get("title") || "";
        const adsParam  = p.get("ads") || "";
        const sig       = p.get("sig") || "";

        if (!targetB64) {
            tg.showPopup({ message:"Target URL missing!" });
            return;
        }

        // ‚îÄ‚îÄ URL SIGNATURE CHECK ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // Sirf bot ke bane links chalenge
        const sigOk = await verifyUrlSignature(targetB64, titleEnc, adsParam, sig);
        if (!sigOk) {
            tg.showPopup({ message:"‚õî Invalid link ‚Äî this link was not created by the bot." });
            return;
        }

        // ‚îÄ‚îÄ DECODE TARGET ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        let url;
        try {
            // urlsafe base64 decode
            const pad = targetB64.replace(/-/g,'+').replace(/_/g,'/') + "==".slice((targetB64.length+2)%4===0?4:(targetB64.length+2)%4);
            url = atob(pad);
        } catch {
            tg.showPopup({ message: SETTINGS.err });
            return;
        }

        // ‚îÄ‚îÄ AD-FREE USER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        if (isAdFreeUser()) {
            location.href = url;
            return;
        }

        // ‚îÄ‚îÄ PARSE ADS PARAM ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        const ap = await parseAdsParam(adsParam, targetB64);

        if (ap.mode === "invalid") {
            // Someone tried to forge the URL or use an old-format link
            tg.showPopup({ message:"‚õî Invalid link format. Please get a fresh link from the bot." });
            return;
        }

        if (ap.mode === "free") {
            // Bot granted ad-free for this specific link
            location.href = url;
            return;
        }

        const ads = ap.mode === "custom" ? ap.ads : DEFAULT_ADS;
        if (!ads || !ads.length) { location.href = url; return; }

        pingBot("visit");
        startAdFlow(ads, url);

    }, SETTINGS.rest);
});

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   OTHER BUTTONS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
document.querySelectorAll(".tap-btn").forEach(b => {
    b.addEventListener("click", function(e) {
        e.preventDefault();
        const url = this.getAttribute("href");
        playSound();
        if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred("medium");
        this.classList.add("click-active");
        setTimeout(() => { this.classList.remove("click-active"); if (url) location.href = url; }, SETTINGS.rest);
    });
});
</script>
</body>
</html>
